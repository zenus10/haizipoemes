---
// Contact Page - 联系页面
// 联系表单

import BaseLayout from '../layouts/BaseLayout.astro';
import '../styles/pages/contact.css';

// Formspree 表单 ID - 从环境变量获取
// 获取方式：
// 1. 访问 https://formspree.io/ 注册账号
// 2. 创建新表单，获取 form ID（格式如：xpznvwqr）
// 3. 在 .env 文件中设置: PUBLIC_FORMSPREE_ID=your_form_id
const formspreeId = import.meta.env.PUBLIC_FORMSPREE_ID || 'YOUR_FORM_ID';
const formAction = `https://formspree.io/f/${formspreeId}`;
---

<BaseLayout title="联系" description="联系我们 - 关于海子诗歌网站的任何问题、建议或合作意向，欢迎随时与我们取得联系" currentPage="contact" fullWidth>
  <div class="contact-page">
    <div class="contact-container">

      <!-- 左卡片：联系信息 -->
      <div class="contact-card contact-info-card">
        <h1 class="contact-title">联系与交流</h1>
        <p class="contact-subtitle">
          有任何问题、建议或合作意向，欢迎随时联系我们。
        </p>

        <div class="contact-details">
          <div class="contact-item">
            <svg class="contact-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="2" y="4" width="20" height="16" rx="2"/>
              <path d="M22 4L12 13 2 4"/>
            </svg>
            <div>
              <span class="contact-item-label">邮箱</span>
              <a href="mailto:630995120@qq.com" class="contact-item-value">630995120@qq.com</a>
            </div>
          </div>
        </div>

        <div class="contact-divider"></div>

        <blockquote class="contact-quote">
          <p>"从明天起，做一个幸福的人"</p>
          <cite>—— 海子</cite>
        </blockquote>
      </div>

      <!-- 右卡片：联系表单 -->
      <div class="contact-card contact-form-card">
        <form
          class="contact-form"
          id="contactForm"
          action={formAction}
          method="POST"
        >
          <h2 class="form-heading">发送消息</h2>

          <div class="form-row">
            <div class="form-group">
              <label for="name" class="form-label">姓名 <span class="required">*</span></label>
              <input
                type="text"
                id="name"
                name="name"
                class="form-input"
                required
                placeholder="请输入姓名"
              />
            </div>
            <div class="form-group">
              <label for="email" class="form-label">邮箱 <span class="required">*</span></label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-input"
                required
                placeholder="请输入邮箱地址"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="subject" class="form-label">主题</label>
            <input
              type="text"
              id="subject"
              name="subject"
              class="form-input"
              placeholder="请输入主题"
            />
          </div>

          <div class="form-group">
            <label for="message" class="form-label">留言 <span class="required">*</span></label>
            <textarea
              id="message"
              name="message"
              class="form-input form-textarea"
              required
              rows="4"
              placeholder="请输入留言内容..."
            ></textarea>
          </div>

          <!-- Formspree reply-to -->
          <input type="hidden" name="_replyto" />
          <!-- Honeypot anti-spam -->
          <input type="text" name="_gotcha" style="display:none" />

          <button type="submit" class="form-submit" id="submitBtn">
            <span class="submit-text">发送消息</span>
            <span class="submit-loading" style="display:none">
              <svg class="spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
              </svg>
              发送中...
            </span>
          </button>

          <!-- Success/Error messages -->
          <div class="form-message form-success" id="formSuccess" style="display:none">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <span>消息已发送！感谢您的联系。</span>
          </div>
          <div class="form-message form-error" id="formError" style="display:none">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            <span>发送失败，请稍后重试。</span>
          </div>
        </form>
      </div>

    </div>
  </div>
</BaseLayout>

<!-- Contact form AJAX submission -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contactForm') as HTMLFormElement;
    const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;
    const submitText = submitBtn?.querySelector('.submit-text') as HTMLElement;
    const submitLoading = submitBtn?.querySelector('.submit-loading') as HTMLElement;
    const successMsg = document.getElementById('formSuccess') as HTMLElement;
    const errorMsg = document.getElementById('formError') as HTMLElement;

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';

      submitBtn.disabled = true;
      submitText.style.display = 'none';
      submitLoading.style.display = 'inline-flex';

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' },
        });

        if (response.ok) {
          successMsg.style.display = 'flex';
          form.reset();
        } else {
          errorMsg.style.display = 'flex';
        }
      } catch {
        errorMsg.style.display = 'flex';
      } finally {
        submitBtn.disabled = false;
        submitText.style.display = 'inline';
        submitLoading.style.display = 'none';
      }
    });
  });
</script>
