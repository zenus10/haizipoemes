import"./hoisted.DT3LsV5r.js";const p=40,b=5,G=150,w="poetry-filter-state";function O(){const h=window.__POEMS_DATA__||[],c=document.getElementById("poemList"),B=document.getElementById("scrollSentinel"),L=document.getElementById("scrollViewport"),u=document.getElementById("poemSearch"),$=document.getElementById("searchButton"),Y=document.getElementById("clearFilters"),q=document.getElementById("poemCount"),x=document.getElementById("poemListEmpty"),f=document.querySelectorAll(".filter-group-toggle"),A=document.querySelectorAll('.filter-option input[type="checkbox"]');if(!c||!B||!L)return;let s=[],g=-1,y=-1,r=null,I=!1,E=null;f.forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-group"),e=document.querySelector(`[data-group-content="${n}"]`);t.classList.toggle("collapsed"),e?.classList.toggle("hidden"),k()})});function i(t=!1){const n=u.value.toLowerCase().trim(),e=Array.from(document.querySelectorAll('input[name="type"]:checked')).map(o=>o.value),l=Array.from(document.querySelectorAll('input[name="year"]:checked')).map(o=>o.value);if(s=h.filter(o=>{const m=!n||o.title.toLowerCase().includes(n),S=e.length===0||e.includes(o.type),d=l.length===0||l.includes(o.year);return m&&S&&d}),B.style.height=s.length*p+"px",t||(c.scrollTop=0),g=-1,y=-1,x){const o=s.length===0;x.classList.toggle("visible",o),c.style.display=o?"none":""}v(),q&&(q.textContent=s.length===h.length?`${h.length} 首`:`${s.length} / ${h.length} 首`),k()}function v(){const t=c.scrollTop,n=c.clientHeight;if(n===0)return;const e=Math.floor(t/p),l=Math.ceil(n/p),o=Math.max(0,e-b),m=Math.min(s.length,e+l+b);if(o===g&&m===y)return;g=o,y=m;const S=document.createDocumentFragment();for(let d=o;d<m;d++){const N=s[d],a=document.createElement("a");a.href=`/poetry/${N.id}`,a.className="poem-item",a.style.top=d*p+"px",a.style.height=p+"px";const _=document.createElement("span");_.className="poem-dot";const C=document.createElement("span");C.className="poem-title",C.textContent=N.title,a.appendChild(_),a.appendChild(C),S.appendChild(a)}L.innerHTML="",L.appendChild(S)}function D(){I||(I=!0,requestAnimationFrame(()=>{v(),I=!1}))}c.addEventListener("scroll",D,{passive:!0}),u?.addEventListener("input",()=>{r!==null&&clearTimeout(r),r=setTimeout(()=>{r=null,i()},G)}),$?.addEventListener("click",()=>{r!==null&&(clearTimeout(r),r=null),i()}),A.forEach(t=>{t.addEventListener("change",()=>i())}),Y?.addEventListener("click",()=>{A.forEach(t=>{t.checked=!1}),u.value="",f.forEach(t=>{t.classList.remove("collapsed");const n=t.getAttribute("data-group");document.querySelector(`[data-group-content="${n}"]`)?.classList.remove("hidden")});try{sessionStorage.removeItem(w)}catch{}i()});function k(){try{const t=[];f.forEach(e=>{if(e.classList.contains("collapsed")){const l=e.getAttribute("data-group");l&&t.push(l)}});const n={checkedTypes:Array.from(document.querySelectorAll('input[name="type"]:checked')).map(e=>e.value),checkedYears:Array.from(document.querySelectorAll('input[name="year"]:checked')).map(e=>e.value),searchText:u.value,scrollTop:c.scrollTop,collapsedGroups:t};sessionStorage.setItem(w,JSON.stringify(n))}catch{}}function M(){try{const t=sessionStorage.getItem(w);if(!t)return!1;const n=JSON.parse(t);return A.forEach(e=>{const l=e.name,o=e.value;l==="type"?e.checked=n.checkedTypes.includes(o):l==="year"&&(e.checked=n.checkedYears.includes(o))}),u.value=n.searchText||"",n.collapsedGroups&&n.collapsedGroups.length>0&&f.forEach(e=>{const l=e.getAttribute("data-group");l&&n.collapsedGroups.includes(l)&&(e.classList.add("collapsed"),document.querySelector(`[data-group-content="${l}"]`)?.classList.add("hidden"))}),i(!0),n.scrollTop>0&&(c.scrollTop=n.scrollTop,v()),!0}catch{return!1}}window.addEventListener("resize",()=>{E!==null&&clearTimeout(E),E=setTimeout(()=>{E=null,g=-1,y=-1,v()},100)}),window.addEventListener("pageshow",t=>{t.persisted&&M()});let T=null;c.addEventListener("scroll",()=>{T!==null&&clearTimeout(T),T=setTimeout(()=>{T=null,k()},300)},{passive:!0}),M()||i()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",O):O();
